# ğŸ›ï¸ Review Cockpit

The **Review Cockpit** is a powerful Streamlit-based GUI that sits on top of the Git Diff RAG engine. It provides an interactive environment for managing repositories, composing prompts, running analyses, and tracking history.

## ğŸš€ Getting Started

To launch the Cockpit:

```bash
source .venv/bin/activate
streamlit run cockpit/app.py
```

The interface will open in your default browser at `http://localhost:8501`.

## ğŸ§© Interface Overview

The Cockpit is organized into six master tabs, covering the entire lifecycle of an AI-assisted code review.

### 1. ğŸ” Review Changes
*   **File Tree**: Browse changed files in the selected target/source range.
*   **Diff Viewer**: Visual side-by-side diff of the selected file.
*   **Findings Tower**: Displays real-time alerts for security risks (secrets) or deprecated patterns found in the diff.

### 2. ğŸ§± Compose Prompt
*   **Library Browser**: Access your `prompts/recipes` (workflows) and `prompts/snippets` (atomic blocks).
*   **Drag-and-Drop Assembly**: Click "â•" to add components to your **Active Bundle**.
*   **Live Preview**: See exactly how the final prompt payload will look before sending it to the LLM.
*   **Intelligent Stacking**: The system automatically handles the "Shared Context" (the diff) so you can stack multiple recipes without duplicating the code context.

### 3. ğŸš€ Run Analysis
*   **Execution Engine**: Choose between **Gemini API** (direct) or **Gemini CLI** (agentic mode).
*   **Model Selector**: Dynamically fetches available models (e.g., `gemini-2.0-flash-exp`).
*   **Live DAG**: Visualizes the execution steps as a Directed Acyclic Graph.
*   **Real-time Logs**: Watch the system fetch diffs, render templates, and stream the response.

### 4. ğŸ“œ History
*   **File Output**: Browse the raw artifacts (`prompt.txt`, `response.md`, `diff.patch`) generated by previous runs.
*   **Database View**: Inspect the SQLite history log, including costs, models used, and execution timestamps.

### 5. ğŸ“ Editor
*   **Integrated IDE**: A Monaco-based editor (VS Code style) running directly in the browser.
*   **Dual Mode**: Switch between editing **Recipes** (full workflows) and **Library** (reusable snippets).
*   **Live Saving**: Changes are written immediately to the disk, making prompt engineering rapid and iterative.

### 6. âš™ï¸ Settings
*   **Repository Manager**: Add new repositories or configure existing ones without touching YAML files.
*   **Workflow Config**: Enable/disable specific workflows for each repo.
*   **Model Preferences**: Set default models and paths.

## ğŸ—ï¸ Architecture

The Cockpit is built on **Streamlit** and leverages the core Python scripts of the project:

*   **`ui_utils.py`**: Handles Git operations, file tree generation, and diff parsing.
*   **`config_utils.py`**: Manages the YAML configuration in `repository-setup/`.
*   **`render_prompt.py`**: The same Jinja2 engine used by the CLI is imported here for accurate previews.
*   **`db_manager.py`**: Interfaces with the SQLite database for history tracking.

## ğŸ’¡ Tips & Tricks

*   **Prompt Stacking**: In the "Compose" tab, try adding a "Security Scan" snippet *after* a "PR Review" recipe. The LLM will process both instructions against the same shared diff context.
*   **Hot-Reload**: If you edit a prompt in the **Editor** tab, the **Compose** tab updates instantly.
*   **Agentic Mode**: Select "Gemini CLI" in the Analyze tab to run the request through the `launch_agent.sh` wrapper, enabling more complex, multi-turn agent behaviors (if configured).
